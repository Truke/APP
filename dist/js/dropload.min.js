!function(o){"use strict";function t(o){o.touches||(o.touches=o.originalEvent.touches)}function s(o,t){t._startY=o.touches[0].pageY,t.opts.scrollArea==window?(t._meHeight=l.height(),t._childrenHeight=c.height()):(t._meHeight=t.$element.height(),t._childrenHeight=t.$element.children().height()),t._scrollTop=t.$scrollArea.scrollTop()}function e(t,s){s._curY=t.touches[0].pageY,s._moveY=s._curY-s._startY,s._moveY>0?s.direction="down":s._moveY<0&&(s.direction="up");var e=Math.abs(s._moveY);""!=s.opts.loadUpFn&&s._scrollTop<=0&&"down"==s.direction&&(t.preventDefault(),s.insertDOM||(s.$element.prepend('<div class="'+s.opts.domUp.domClass+'"></div>'),s.insertDOM=!0),s.$domUp=o("."+s.opts.domUp.domClass),a(s.$domUp,0),e<=s.opts.distance?(s._offsetY=e,s.$domUp.html("").append(s.opts.domUp.domRefresh)):e>s.opts.distance&&e<=2*s.opts.distance?(s._offsetY=s.opts.distance+.5*(e-s.opts.distance),s.$domUp.html("").append(s.opts.domUp.domLoad)):s._offsetY=s.opts.distance+.5*s.opts.distance+.2*(e-2*s.opts.distance),s.$domUp.css({height:s._offsetY})),""!=s.opts.loadDownFn&&s._childrenHeight<=s._meHeight+s._scrollTop&&"up"==s.direction&&(t.preventDefault(),s.insertDOM||(s.$element.append('<div class="'+s.opts.domDown.domClass+'"></div>'),s.insertDOM=!0),s.$domDown=o("."+s.opts.domDown.domClass),a(s.$domDown,0),e<=s.opts.distance?(s._offsetY=e,s.$domDown.html("").append(s.opts.domDown.domRefresh)):e>s.opts.distance&&e<=2*s.opts.distance?(s._offsetY=s.opts.distance+.5*(e-s.opts.distance),s.$domDown.html("").append(s.opts.domDown.domUpdate)):s._offsetY=s.opts.distance+.5*s.opts.distance+.2*(e-2*s.opts.distance),s.$domDown.css({height:s._offsetY}),s.$scrollArea.scrollTop(s._offsetY+s._scrollTop))}function d(t){var s=Math.abs(t._moveY);t.insertDOM&&("down"==t.direction?(t.$domResult=t.$domUp,t.domLoad=t.opts.domUp.domLoad):"up"==t.direction&&(t.$domResult=t.$domDown,t.domLoad=t.opts.domDown.domLoad),a(t.$domResult,300),s>t.opts.distance?(t.$domResult.css({height:t.$domResult.children().height()}),t.$domResult.html("").append(t.opts.domUp.domLoad),i(t)):t.$domResult.css({height:"0"}).on("webkitTransitionEnd",function(){t.insertDOM=!1,o(this).remove()}),t._moveY=0)}function n(o){""!=o.opts.touchend&&o.opts.touchend(o)}function i(o){o.loading=!0,""!=o.opts.loadUpFn&&"down"==o.direction?o.opts.loadUpFn(o):""!=o.opts.loadDownFn&&"up"==o.direction&&o.opts.loadDownFn(o)}function a(o,t){o.css({"-webkit-transition":"all "+t+"ms",transition:"all "+t+"ms"})}var p,l=o(window),c=o(document);o.fn.dropload=function(o){return new p(this,o)},p=function(t,s){var e=this;e.$element=o(t),e.insertDOM=!1,e.loading=!1,e.isLock=!1,e.init(s)},p.prototype.init=function(i){var a=this;a.opts=o.extend({},{scrollArea:a.$element,domUp:{domClass:"dropload-up",domRefresh:'<div class="dropload-refresh">↓下拉刷新</div>',domUpdate:'<div class="dropload-update">↑释放更新</div>',domLoad:'<div class="dropload-load"><span class="loading"></span><span>加载中...</span></div>'},domDown:{domClass:"dropload-down",domRefresh:'<div class="dropload-refresh">↑上拉加载更多</div>',domUpdate:'<div class="dropload-update">↓释放加载</div>',domLoad:'<div class="dropload-load"><span class="loading"></span><span>加载中...</span></div>'},distance:50,loadUpFn:"",touchend:"",loadDownFn:""},i),a.$scrollArea=a.opts.scrollArea==window?l:a.opts.scrollArea,a.$element.on("touchstart",function(o){a.loading||a.isLock||n(a)||(t(o),s(o,a))}),a.$element.on("touchmove",function(o){a.loading||a.isLock||(t(o,a),e(o,a))}),a.$element.on("touchend",function(){a.loading||a.isLock||d(a)})},p.prototype.lock=function(){var o=this;o.isLock=!0},p.prototype.unlock=function(){var o=this;o.isLock=!1},p.prototype.resetload=function(){var t=this;t.$domResult&&t.$domResult.css({height:"0"}).on("webkitTransitionEnd",function(){t.loading=!1,t.insertDOM=!1,o(this).remove()})}}(window.Zepto||window.jQuery);